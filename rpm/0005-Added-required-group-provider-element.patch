From 9c1a08c36816375f7de76212314dabe4b6534a5d Mon Sep 17 00:00:00 2001
From: Marko Kenttala <marko.kenttala@jolla.com>
Date: Wed, 19 Feb 2020 11:23:48 +0200
Subject: [PATCH] Added required-group provider element

---
 Accounts/provider.cpp     | 9 +++++++++
 Accounts/provider.h       | 1 +
 tests/MyProvider.provider | 1 +
 tests/accountstest.cpp    | 1 +
 4 files changed, 12 insertions(+)

diff --git a/Accounts/provider.cpp b/Accounts/provider.cpp
index 93a24c5..57a2b59 100644
--- a/Accounts/provider.cpp
+++ b/Accounts/provider.cpp
@@ -171,6 +171,15 @@ bool Provider::isSingleAccount() const
     return ag_provider_get_single_account(m_provider);
 }
 
+/*!
+ * Get the name of the user group required for the provider.
+ * @return The user group name.
+ */
+QString Provider::requiredGroup() const
+{
+    return UTF8(ag_provider_get_required_group(m_provider));
+}
+
 /*!
  * @return The DOM of the whole XML provider file.
  */
diff --git a/Accounts/provider.h b/Accounts/provider.h
index 7c04c3f..8e6832a 100644
--- a/Accounts/provider.h
+++ b/Accounts/provider.h
@@ -63,6 +63,7 @@ public:
     QString iconName() const;
     QString domainsRegExp() const;
     bool isSingleAccount() const;
+    QString requiredGroup() const;
     const QDomDocument domDocument() const;
 
     friend inline bool operator==(const Accounts::Provider &p1,
diff --git a/tests/MyProvider.provider b/tests/MyProvider.provider
index 3ffbbb5..d36a82e 100644
--- a/tests/MyProvider.provider
+++ b/tests/MyProvider.provider
@@ -7,6 +7,7 @@
   <plugin>generic-oauth</plugin>
   <domains>.*example.net</domains>
   <single-account>true</single-account>
+  <required-group>mygroup</required-group>
 
   <template>
     <group name="auth">
diff --git a/tests/accountstest.cpp b/tests/accountstest.cpp
index beaa006..17879aa 100644
--- a/tests/accountstest.cpp
+++ b/tests/accountstest.cpp
@@ -218,6 +218,7 @@ void AccountsTest::providerTestCase()
     QCOMPARE(provider.pluginName(), QString("generic-oauth"));
     QCOMPARE(provider.domainsRegExp(), QString(".*example.net"));
     QCOMPARE(provider.isSingleAccount(), true);
+    QCOMPARE(provider.requiredGroup(), QString("mygroup"));
 
     QDomDocument dom = provider.domDocument();
     QDomElement root = dom.documentElement();
-- 
2.17.1

